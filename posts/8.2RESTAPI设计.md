# API设计
* 用户服务：
  * 用户注册。
  * 用户信息查询：提供一个userName或email，返回目标的用户信息(userName, nickname, email, gender)。
  * 用户信息修改：用户可以修改自己的除了userName以外的信息。
* 会话服务：
  * 身份认证：验证用户名和密码的正确性，返回会话凭据(json web token)。会话凭据中包含：用户信息、过期时间。
  * 客户端发送请求时，要将会话凭据一并发送(除了注册、登陆这些不需要授权的请求)。服务端的会话服务需要验证会话凭据的完整性、是否过期。然后，从会话凭据中读取发送者的信息，以供后续处理使用。
* 好友服务：
  * 指定userName，向其发送添加好友请求。
  * 获取发给自己的所有好友请求。包括请求信息和请求者的用户信息。
  * 对一个发给自己的好友请求作出响应（接受、拒绝）。
  * 获取自己的所有好友。返回每个好友的用户信息。为了减少请求次数，与每个好友的私聊的**基本信息**也一并返回。
* chat服务：
  * chat(聊天)定义：一个chat由**参与者**和**消息历史**组成。
    * 参与者：chat的参与者是**两个**用户时，可以称为**私聊**；有**多个**用户时，可以称为**群聊**。
    * 消息历史：在chat中任何一个参与者发送的消息，都会进入**消息历史**。消息历史由chat拥有。chat的任何参与者都可以读取**消息历史**。每一个消息有一个messageId，messageId是auto increment的(便于比较消息新旧)。
  * 对于**群聊和私聊的区别**，提供以下额外说明：
    * 对于一个群聊，必须有一个参与者是master。
    * 群聊的参与者数量可以改变，私聊的不可以。
    * 每个chat的基本信息包括chatId, chatName, memberCount。群聊的chatName必须为string，私聊的chatName必须为null。
  * 获取参与的chat：查找自己参与的所有chat，返回每个chat的基本信息。
    * 另外，还要返回：该用户在每个chat上分别有多少条**未读消息**，服务器根据**lastReadMessageId**和**群聊当前的消息历史**来计算未读消息。
    * 另外，还要返回：该用户分别在每个chat上的lastReadMessageId，以便客户端在获取chat的消息历史以后，能够自己计算未读消息。
    > 可以看出，这个接口比较特殊，因为它的返回值不仅与**chat**的当前状态有关，还与**用户**的当前状态有关。
  * 获取chat的消息历史：根据chatId返回消息历史。
  * 获取chat的参与者：根据chatId返回参与者列表。返回每个参与者的用户信息。如果是群聊，还会返回master的userName。
  * 向指定的chat发送消息。
  * 提交lastReadMessageId：提交**当前用户**已经阅读的、最新的messageId。为每个用户都存储一个lastReadMessageId。
  * 搜索chat：根据chatId，返回chat的基本信息。
  * 另外，还有一些服务**只能用于群聊**：
    * 创建群聊：指定参与者(只能指定好友)，创建一个新的群聊。不需要指定自己，请求发送者必须参与。请求发送者是新建群聊的master。返回新建群聊的基本信息。
    * 退出群聊。master不可以退出群聊，必须先转移master身份。
    * 申请加入群聊：指定chatId，向其master发送加入申请。不能申请已经加入的群聊。
    * 只有master才有权限请求的服务：
      * 获取所有加入申请。
      * 对一个申请作出响应。
      * 修改chatName。
      * 增加、删除参与者。不可以删除master。
      * 删除一条或多条消息。
      * 转移master：指定另一个参与者为master，自己的master身份消失。
